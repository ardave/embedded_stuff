<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" agent="Claude Code" version="24.0.0" type="device">
  <diagram id="architecture" name="FreeRTOS Architecture">
    <mxGraphModel dx="1100" dy="700" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="700" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- ==================== Title ==================== -->
        <mxCell id="title" value="Fitness Tracker &amp;mdash; FreeRTOS Task Architecture" style="text;html=1;fontSize=18;fontStyle=1;align=center;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="250" y="15" width="500" height="40" as="geometry"/>
        </mxCell>

        <!-- ==================== Hardware ==================== -->
        <mxCell id="hw_gps" value="PA1010D GPS&lt;br&gt;&lt;i&gt;I2C 0x10&lt;/i&gt;" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;size=15;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="30" y="150" width="140" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="hw_oled" value="SH1107 OLED&lt;br&gt;&lt;i&gt;128x128  I2C 0x3D&lt;/i&gt;" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;size=15;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="710" y="370" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- ==================== Tasks ==================== -->
        <mxCell id="task_gps" value="&lt;b&gt;GPS Acquisition&lt;/b&gt;&lt;br&gt;pri=10  stack=6144" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="240" y="150" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="task_agg" value="&lt;b&gt;GPS Aggregator&lt;/b&gt;&lt;br&gt;pri=5  stack=6144" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="680" y="90" width="170" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="task_sd" value="&lt;b&gt;SD Card Logger&lt;/b&gt;&lt;br&gt;pri=5  stack=6144" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="680" y="230" width="170" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="task_disp" value="&lt;b&gt;Display Task&lt;/b&gt;&lt;br&gt;pri=4  stack=8192" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="480" y="370" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="main_fn" value="&lt;b&gt;main()&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="370" width="120" height="60" as="geometry"/>
        </mxCell>

        <!-- ==================== Queues ==================== -->
        <mxCell id="q_sentence" value="&lt;b&gt;sentence_queue&lt;/b&gt;&lt;br&gt;&lt;i&gt;GpsSentence  cap=4&lt;/i&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="470" y="90" width="145" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="q_reading" value="&lt;b&gt;reading_queue&lt;/b&gt;&lt;br&gt;&lt;i&gt;GpsReading  cap=4&lt;/i&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="470" y="230" width="145" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="q_display" value="&lt;b&gt;display_queue&lt;/b&gt;&lt;br&gt;&lt;i&gt;DisplayMessage  cap=4&lt;/i&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="250" y="370" width="155" height="60" as="geometry"/>
        </mxCell>

        <!-- ==================== Planned tasks ==================== -->
        <mxCell id="planned_box" value="&lt;i&gt;Planned (not yet implemented)&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 4;fillColor=none;strokeColor=#999999;fontColor=#999999;fontSize=11;verticalAlign=top;spacingTop=2;" vertex="1" parent="1">
          <mxGeometry x="30" y="490" width="840" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="stub_activity" value="activity_state" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#fafafa;strokeColor=#cccccc;fontColor=#999999;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="50" y="518" width="130" height="32" as="geometry"/>
        </mxCell>
        <mxCell id="stub_battery" value="battery_monitor" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#fafafa;strokeColor=#cccccc;fontColor=#999999;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="250" y="518" width="130" height="32" as="geometry"/>
        </mxCell>
        <mxCell id="stub_button" value="user_button" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#fafafa;strokeColor=#cccccc;fontColor=#999999;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="518" width="130" height="32" as="geometry"/>
        </mxCell>
        <mxCell id="stub_wifi" value="wifi_upload" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#fafafa;strokeColor=#cccccc;fontColor=#999999;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="660" y="518" width="130" height="32" as="geometry"/>
        </mxCell>

        <!-- ==================== Edges ==================== -->
        <!-- PA1010D → GPS Task -->
        <mxCell id="e1" value="I2C" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;html=1;fontSize=10;fontStyle=2;strokeColor=#666666;" edge="1" source="hw_gps" target="task_gps" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- GPS Task → sentence_queue -->
        <mxCell id="e2" value="GpsSentence" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;html=1;fontSize=10;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" source="task_gps" target="q_sentence" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- sentence_queue → GPS Aggregator -->
        <mxCell id="e3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="q_sentence" target="task_agg" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- GPS Task → reading_queue -->
        <mxCell id="e4" value="GpsReading" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;html=1;fontSize=10;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" source="task_gps" target="q_reading" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- reading_queue → SD Card Logger -->
        <mxCell id="e5" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="q_reading" target="task_sd" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- main() → display_queue -->
        <mxCell id="e6" value="DisplayMessage" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;html=1;fontSize=10;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" source="main_fn" target="q_display" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- display_queue → Display Task -->
        <mxCell id="e7" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="q_display" target="task_disp" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Display Task → SH1107 OLED -->
        <mxCell id="e8" value="I2C" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;html=1;fontSize=10;fontStyle=2;strokeColor=#666666;" edge="1" source="task_disp" target="hw_oled" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Legend ==================== -->
        <mxCell id="legend_box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#cccccc;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="590" width="840" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="leg1" value="Task" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="50" y="600" width="60" height="28" as="geometry"/>
        </mxCell>
        <mxCell id="leg2" value="Queue" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=6;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="185" y="598" width="60" height="32" as="geometry"/>
        </mxCell>
        <mxCell id="leg3" value="Hardware" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;size=10;fillColor=#f5f5f5;strokeColor=#666666;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="325" y="600" width="80" height="28" as="geometry"/>
        </mxCell>
        <mxCell id="leg4" value="Planned" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#fafafa;strokeColor=#cccccc;fontColor=#999999;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="475" y="600" width="60" height="28" as="geometry"/>
        </mxCell>
        <mxCell id="leg5" value="&lt;i&gt;Arrow = FreeRTOS queue or I2C bus&lt;/i&gt;" style="text;html=1;fontSize=9;align=left;verticalAlign=middle;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="600" y="600" width="200" height="28" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
